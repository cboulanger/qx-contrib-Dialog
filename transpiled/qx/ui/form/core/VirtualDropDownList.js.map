{
  "version": 3,
  "sources": [
    "/home/travis/build/cboulanger/qx-contrib-Dialog/node_modules/qxcompiler/node_modules/qooxdoo-sdk/framework/source/class/qx/ui/form/core/VirtualDropDownList.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "ui",
    "popup",
    "Popup",
    "construct",
    "target",
    "core",
    "Assert",
    "assertNotNull",
    "assertNotUndefined",
    "assertInterface",
    "form",
    "AbstractVirtualBox",
    "layout",
    "VBox",
    "_target",
    "_createChildControl",
    "addListener",
    "__onChangeVisibility",
    "__defaultSelection",
    "data",
    "Array",
    "initSelection",
    "properties",
    "autoHide",
    "refine",
    "init",
    "keepActive",
    "selection",
    "check",
    "event",
    "apply",
    "nullable",
    "deferredInit",
    "allowGrowDropDown",
    "events",
    "members",
    "_preselected",
    "__ignoreSelection",
    "__ignoreListSelection",
    "__cachedMaxListItemWidth",
    "open",
    "placeToWidget",
    "show",
    "close",
    "hide",
    "setPreselected",
    "modelItem",
    "listSelection",
    "getChildControl",
    "getSelection",
    "helper",
    "__synchronizeSelection",
    "dispose",
    "_createChildControlImpl",
    "id",
    "hash",
    "control",
    "list",
    "List",
    "set",
    "focusable",
    "keepFocus",
    "height",
    "width",
    "maxHeight",
    "getMaxListHeight",
    "selectionMode",
    "quickSelection",
    "_onListChangeSelection",
    "_handlePointer",
    "_onChangeModel",
    "_onChangeModelLength",
    "_onChangeDelegate",
    "add",
    "flex",
    "_handleKeyboard",
    "isVisible",
    "getKeyIdentifier",
    "__selectPreselected",
    "clone",
    "setTarget",
    "setBubbles",
    "dispatchEvent",
    "__onChangeSelection",
    "getItem",
    "_adjustSize",
    "getAllowGrowDropDown",
    "_recalculateMaxListItemWidth",
    "removeAll",
    "_applySelection",
    "value",
    "old",
    "removeListener",
    "splice",
    "source",
    "equals",
    "getLength",
    "spliceArg",
    "length",
    "concat",
    "toArray",
    "getBounds",
    "addListenerOnce",
    "_adjustWidth",
    "_adjustHeight",
    "uiList",
    "setWidth",
    "resetWidth",
    "availableHeight",
    "_getAvailableHeight",
    "itemsHeight",
    "getPane",
    "getRowConfig",
    "getTotalSize",
    "minHeight",
    "getMinHeight",
    "setMaxHeight",
    "distance",
    "getLayoutLocation",
    "viewPortHeight",
    "bom",
    "Viewport",
    "getHeight",
    "toTop",
    "top",
    "toBottom",
    "bottom",
    "maxWidth",
    "model",
    "getModel",
    "createWidget",
    "util",
    "Delegate",
    "getMethod",
    "getDelegate",
    "ListItem",
    "tempListItem",
    "syncAppearance",
    "styles",
    "font",
    "getFont",
    "theme",
    "manager",
    "Font",
    "getInstance",
    "resolve",
    "getStyles",
    "getDefaultStyles",
    "paddingX",
    "getPaddingLeft",
    "getPaddingRight",
    "getMarginLeft",
    "getMarginRight",
    "label",
    "forEach",
    "item",
    "content",
    "get",
    "getLabelPath",
    "Label",
    "getHtmlSize",
    "undefined",
    "_getMaxListItemWidth",
    "destruct",
    "VirtualDropDownList"
  ],
  "mappings": "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",
  "file": "VirtualDropDownList.js",
  "sourcesContent": [
    "/* ************************************************************************\n\n   qooxdoo - the new era of web development\n\n   http://qooxdoo.org\n\n   Copyright:\n     2011 1&1 Internet AG, Germany, http://www.1und1.de\n\n   License:\n     MIT: https://opensource.org/licenses/MIT\n     See the LICENSE file in the project's top-level directory for details.\n\n   Authors:\n     * Christian Hagendorn (chris_schmidt)\n\n************************************************************************ */\n\n/**\n * A drop-down (popup) widget which contains a virtual list for selection.\n *\n * @childControl list {qx.ui.list.List} The virtual list.\n *\n * @internal\n */\nqx.Class.define(\"qx.ui.form.core.VirtualDropDownList\",\n{\n  extend  : qx.ui.popup.Popup,\n\n\n  /**\n   * Creates the drop-down list.\n   *\n   * @param target {qx.ui.form.core.AbstractVirtualBox} The composite widget.\n   */\n  construct : function(target)\n  {\n    qx.core.Assert.assertNotNull(target, \"Invalid parameter 'target'!\");\n    qx.core.Assert.assertNotUndefined(target, \"Invalid parameter 'target'!\");\n    qx.core.Assert.assertInterface(target, qx.ui.form.core.AbstractVirtualBox,\n      \"Invalid parameter 'target'!\");\n\n    this.base(arguments, new qx.ui.layout.VBox());\n\n    this._target = target;\n\n    this._createChildControl(\"list\");\n    this.addListener(\"changeVisibility\", this.__onChangeVisibility, this);\n\n    this.__defaultSelection = new qx.data.Array();\n    this.initSelection(this.__defaultSelection);\n  },\n\n\n  properties :\n  {\n    // overridden\n    autoHide :\n    {\n      refine : true,\n      init : false\n    },\n\n\n    // overridden\n    keepActive :\n    {\n      refine : true,\n      init : true\n    },\n\n\n    /** Current selected items. */\n    selection :\n    {\n      check : \"qx.data.Array\",\n      event : \"changeSelection\",\n      apply : \"_applySelection\",\n      nullable : false,\n      deferredInit : true\n    },\n\n\n    /**\n     * Allow the drop-down to grow wider than its parent.\n     */\n    allowGrowDropDown :\n    {\n      init : false,\n      nullable : false,\n      check : \"Boolean\",\n      apply : \"_adjustSize\",\n      event : \"changeAllowGrowDropDown\"\n    }\n  },\n\n\n  events : {\n    /**\n     * This event is fired as soon as the content of the selection property changes, but\n     * this is not equal to the change of the selection of the widget. If the selection\n     * of the widget changes, the content of the array stored in the selection property\n     * changes. This means you have to listen to the change event of the selection array\n     * to get an event as soon as the user changes the selected item.\n     * <pre class=\"javascript\">obj.getSelection().addListener(\"change\", listener, this);</pre>\n     */\n    \"changeSelection\" : \"qx.event.type.Data\"\n  },\n\n\n  members :\n  {\n    /** @type {qx.ui.form.core.AbstractVirtualBox} The composite widget. */\n    _target : null,\n\n\n    /** @type {var} The pre-selected model item. */\n    _preselected : null,\n\n\n    /**\n     * @type {Boolean} Indicator to ignore selection changes from the\n     * {@link #selection} array.\n     */\n    __ignoreSelection : false,\n\n\n    /** @type {Boolean} Indicator to ignore selection changes from the list. */\n    __ignoreListSelection : false,\n\n\n    /** @type {qx.data.Array} The initial selection array. */\n    __defaultSelection : null,\n\n\n    /**\n     * When the drop-down is allowed to grow wider than its parent,\n     * this member variable will contain the cached maximum list item width in pixels.\n     * This variable gets updated whenever the model or model length changes.\n     *\n     * @type {Number}\n     */\n    __cachedMaxListItemWidth : 0,\n\n\n    /*\n    ---------------------------------------------------------------------------\n      PUBLIC API\n    ---------------------------------------------------------------------------\n    */\n\n\n    /**\n     * Shows the drop-down.\n     */\n    open : function()\n    {\n      this.placeToWidget(this._target, true);\n      this.show();\n    },\n\n\n    /**\n     * Hides the drop-down.\n     */\n    close : function() {\n      this.hide();\n    },\n\n\n    /**\n     * Pre-selects the drop-down item corresponding to the given model object.\n     *\n     * @param modelItem {Object} Item to be pre-selected.\n     */\n    setPreselected : function(modelItem)\n    {\n      this._preselected = modelItem;\n      this.__ignoreListSelection = true;\n      var listSelection = this.getChildControl(\"list\").getSelection();\n      var helper = new qx.data.Array([modelItem]);\n      this.__synchronizeSelection(helper, listSelection);\n      helper.dispose();\n      this.__ignoreListSelection = false;\n    },\n\n\n    /*\n    ---------------------------------------------------------------------------\n      INTERNAL API\n    ---------------------------------------------------------------------------\n    */\n\n\n    // overridden\n    _createChildControlImpl : function(id, hash)\n    {\n      var control;\n\n      switch(id)\n      {\n        case \"list\":\n          control = new qx.ui.list.List().set({\n            focusable: false,\n            keepFocus: true,\n            keepActive: true,\n            height: null,\n            width: null,\n            maxHeight: this._target.getMaxListHeight(),\n            selectionMode: \"one\",\n            quickSelection: true\n          });\n\n          control.getSelection().addListener(\"change\", this._onListChangeSelection, this);\n          control.addListener(\"tap\", this._handlePointer, this);\n          control.addListener(\"changeModel\", this._onChangeModel, this);\n          control.addListener(\"changeModelLength\", this._onChangeModelLength, this);\n          control.addListener(\"changeDelegate\", this._onChangeDelegate, this);\n\n          this.add(control, {flex: 1});\n          break;\n      }\n\n      return control || this.base(arguments, id, hash);\n    },\n\n\n    /*\n    ---------------------------------------------------------------------------\n      EVENT LISTENERS\n    ---------------------------------------------------------------------------\n    */\n\n\n    /**\n     * Handles the complete keyboard events dispatched on the widget.\n     *\n     * @param event {qx.event.type.KeySequence} The keyboard event.\n     */\n    _handleKeyboard : function(event)\n    {\n      if (this.isVisible() && event.getKeyIdentifier() === \"Enter\") {\n        this.__selectPreselected();\n        return;\n      }\n\n      var clone = event.clone();\n      clone.setTarget(this.getChildControl(\"list\"));\n      clone.setBubbles(false);\n\n      this.getChildControl(\"list\").dispatchEvent(clone);\n    },\n\n\n    /**\n     * Handles all mouse events dispatched on the widget.\n     *\n     * @param event {qx.event.type.Mouse} The mouse event.\n     */\n    _handlePointer : function(event) {\n      this.__selectPreselected();\n    },\n\n\n    /**\n     * Handler for the local selection change. The method is responsible for\n     * the synchronization between the own selection and the selection\n     * form the drop-down.\n     *\n     * @param event {qx.event.type.Data} The data event.\n     */\n    __onChangeSelection : function(event)\n    {\n      if (this.__ignoreSelection) {\n        return;\n      }\n\n      var selection = this.getSelection();\n      var listSelection = this.getChildControl(\"list\").getSelection();\n\n      this.__ignoreListSelection = true;\n      this.__synchronizeSelection(selection, listSelection);\n      this.__ignoreListSelection = false;\n\n      this.__ignoreSelection = true;\n      this.__synchronizeSelection(listSelection, selection);\n      this.__ignoreSelection = false;\n    },\n\n\n    /**\n     * Handler for the selection change on the list. The method is responsible\n     * for the synchronization between the list selection and the own selection.\n     *\n     * @param event {qx.event.type.Data} The data event.\n     */\n    _onListChangeSelection : function(event)\n    {\n      if (this.__ignoreListSelection) {\n        return;\n      }\n\n      var listSelection = this.getChildControl(\"list\").getSelection();\n\n      if (this.isVisible()) {\n        this.setPreselected(listSelection.getItem(0));\n      } else {\n        this.__ignoreSelection = true;\n        this.__synchronizeSelection(listSelection, this.getSelection());\n        this.__ignoreSelection = false;\n      }\n    },\n\n\n    /**\n     * Handler for the own visibility changes. The method is responsible that\n     * the list selects the current selected item.\n     *\n     * @param event {qx.event.type.Data} The event.\n     */\n    __onChangeVisibility : function(event)\n    {\n      if (this.isVisible())\n      {\n        if (this._preselected == null)\n        {\n          var selection = this.getSelection();\n          var listSelection = this.getChildControl(\"list\").getSelection();\n          this.__synchronizeSelection(selection, listSelection);\n        }\n        this._adjustSize();\n      } else {\n        this.setPreselected(null);\n      }\n    },\n\n\n    /**\n     * Handler for the model change event.\n     * Called when the whole model changes, not when its length changes.\n     *\n     * @param event {qx.event.type.Data} The change event.\n     * @protected\n     */\n    _onChangeModel : function(event) {\n      if (this.getAllowGrowDropDown()) {\n        this._recalculateMaxListItemWidth();\n      }\n\n      this._adjustSize();\n    },\n\n\n    /**\n     * Handler for the model length change event.\n     * Called whenever items get added or removed from the model,\n     * not when the model itself changes.\n     *\n     * @param event {qx.event.type.Data}\n     * @protected\n     */\n    _onChangeModelLength : function (event) {\n      if (this.getAllowGrowDropDown()) {\n        this._recalculateMaxListItemWidth();\n      }\n\n      this._adjustSize();\n    },\n\n\n    /**\n     * Handler for the delegate change event.\n     *\n     * @param event {qx.event.type.Data} The change event.\n     */\n    _onChangeDelegate : function(event) {\n      this.getSelection().removeAll();\n    },\n\n\n    /*\n    ---------------------------------------------------------------------------\n      APPLY ROUTINES\n    ---------------------------------------------------------------------------\n    */\n\n\n    // property apply\n    _applySelection : function(value, old)\n    {\n      value.addListener(\"change\", this.__onChangeSelection, this);\n\n      if (old != null) {\n        old.removeListener(\"change\", this.__onChangeSelection, this);\n      }\n\n      this.__synchronizeSelection(\n        value, this.getChildControl(\"list\").getSelection(value)\n      );\n    },\n\n\n    /*\n    ---------------------------------------------------------------------------\n      HELPER METHODS\n    ---------------------------------------------------------------------------\n    */\n\n\n    /**\n     * Helper method to select the current preselected item, also closes the\n     * drop-down.\n     */\n    __selectPreselected : function()\n    {\n      if (this._preselected != null)\n      {\n        var selection = this.getSelection();\n        selection.splice(0, 1, this._preselected);\n        this._preselected = null;\n        this.close();\n      }\n    },\n\n\n    /**\n     * Helper method to synchronize both selection. The target selection has\n     * the same selection like the source selection after the synchronization.\n     *\n     * @param source {qx.data.Array} The source selection.\n     * @param target {qx.data.Array} The target selection.\n     */\n    __synchronizeSelection : function(source, target)\n    {\n      if (source.equals(target)) {\n        return;\n      }\n\n      if (source.getLength() <= 0) {\n        target.removeAll();\n      }\n      else\n      {\n        // build arguments array for splice(0, target.length, source[0], source[1], ...)\n        var spliceArg = [0, target.length];\n        spliceArg = spliceArg.concat(source.toArray());\n\n        // use apply since it allow to use an array as the argument array\n        // (calling splice directly with an array insert it in the array on which splice is called)\n        // don't forget to dispose the array created by splice\n        target.splice.apply(target, spliceArg).dispose();\n      }\n    },\n\n\n    /**\n     * Adjust the drop-down to the available width and height, by calling\n     * {@link #_adjustWidth} and {@link #_adjustHeight}.\n     */\n    _adjustSize : function()\n    {\n      if (!this._target.getBounds()) {\n        this.addListenerOnce(\"appear\", this._adjustSize, this);\n        return;\n      }\n\n      this._adjustWidth();\n      this._adjustHeight();\n    },\n\n\n    /**\n     * Adjust the drop-down to the available width. The width is limited by\n     * the current width from the _target, unless allowGrowDropDown is true.\n     */\n    _adjustWidth : function()\n    {\n      var width = this._target.getBounds().width;\n      var uiList = this.getChildControl('list');\n      if (this.getAllowGrowDropDown()) {\n        // Let the drop-down handle its own width.\n        this.setWidth(null);\n\n        if (this.__cachedMaxListItemWidth > 0) {\n          uiList.setWidth(this.__cachedMaxListItemWidth);\n        } else {\n          uiList.setWidth(width);\n        }\n      } else {\n        // Make the drop-down as wide as the virtual-box that it is owned by.\n        this.setWidth(width);\n        uiList.resetWidth();\n      }\n    },\n\n\n    /**\n     * Adjust the drop-down to the available height. Ensure that the list\n     * is never bigger that the max list height and the available space\n     * in the viewport.\n     */\n    _adjustHeight : function()\n    {\n      var availableHeight = this._getAvailableHeight();\n      if (availableHeight === null) {\n        return;\n      }\n\n      var maxHeight = this._target.getMaxListHeight();\n      var list = this.getChildControl(\"list\");\n      var itemsHeight = list.getPane().getRowConfig().getTotalSize();\n\n      if (maxHeight == null || itemsHeight < maxHeight) {\n        maxHeight = itemsHeight;\n      }\n\n      if (maxHeight > availableHeight) {\n        maxHeight = availableHeight;\n      }\n\n      var minHeight = list.getMinHeight();\n      if (null !== minHeight && minHeight > maxHeight) {\n        maxHeight = minHeight;\n      }\n\n      list.setMaxHeight(maxHeight);\n    },\n\n\n    /**\n     * Calculates the available height in the viewport.\n     *\n     * @return {Integer|null} Available height in the viewport.\n     */\n    _getAvailableHeight : function()\n    {\n      var distance = this.getLayoutLocation(this._target);\n      if (!distance) {\n        return null;\n      }\n\n      var viewPortHeight = qx.bom.Viewport.getHeight();\n\n      // distance to the bottom and top borders of the viewport\n      var toTop = distance.top;\n      var toBottom = viewPortHeight - distance.bottom;\n\n      return toTop > toBottom ? toTop : toBottom;\n    },\n\n\n    /**\n     * Loop over all model items to recalculate the maximum list item width.\n     *\n     * @protected\n     */\n    _recalculateMaxListItemWidth : function () {\n      var maxWidth = 0;\n      var list = this.getChildControl(\"list\");\n      var model = list.getModel();\n      if (model && model.length) {\n        var createWidget = qx.util.Delegate.getMethod(list.getDelegate(), \"createItem\");\n        if (!createWidget) {\n          createWidget = function () {\n            return new qx.ui.form.ListItem();\n          };\n        }\n\n        var tempListItem = createWidget();\n\n        // Make sure the widget has the correct padding properties.\n        tempListItem.syncAppearance();\n\n        var styles;\n        var font = tempListItem.getFont();\n        if (font) {\n          styles = qx.theme.manager.Font.getInstance().resolve(font).getStyles();\n        }\n        if (!styles) {\n          styles = qx.bom.Font.getDefaultStyles();\n        }\n\n        var paddingX =\n          list.getPaddingLeft() + list.getPaddingRight() +\n          tempListItem.getPaddingLeft() + tempListItem.getPaddingRight() +\n          tempListItem.getMarginLeft() + tempListItem.getMarginRight();\n\n        var label = tempListItem.getChildControl('label');\n        if (label) {\n          // Make sure the widget has the correct padding properties.\n          label.syncAppearance();\n\n          paddingX +=\n            label.getPaddingLeft() + label.getPaddingRight() +\n            label.getMarginLeft() + label.getMarginRight();\n        }\n\n        model.forEach(function (item) {\n          var width = 0;\n          var content;\n\n          if (typeof item === \"string\") {\n            content = item;\n          } else if (typeof item === \"object\" && item !== null) {\n            content = item.get(list.getLabelPath());\n          }\n\n          if (content) {\n            width = qx.bom.Label.getHtmlSize(content, styles, undefined).width + paddingX;\n\n            if (width > maxWidth) {\n              maxWidth = width;\n            }\n          }\n        });\n\n        tempListItem.dispose();\n      }\n\n      this.__cachedMaxListItemWidth = maxWidth;\n    },\n\n\n    /**\n     * Get the cached maximum list item width.\n     *\n     * @return {Number}\n     * @protected\n     */\n    _getMaxListItemWidth : function () {\n      return this.__cachedMaxListItemWidth;\n    }\n  },\n\n  destruct : function()\n  {\n    if (this.__defaultSelection) {\n      this.__defaultSelection.dispose();\n    }\n  }\n});\n"
  ]
}